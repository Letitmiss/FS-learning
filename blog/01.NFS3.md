
# NFS的权限解读

## 访问服务端的权限

#### 客户端以一般用户身份去访问共享目录资源时,NFS Server所提供的文件系统会让我们以什么身份去访问? 

* 实际上,NFS本身并没有进行用户身份验证 所以当在客户端以一般用户身份想要访问文件系统时,服务器端会以客户端用户的UID和GID等身份信息来尝试读取服务端的文件系统. 所以问题又有了, 如果客户端与服务端的用户身份并不一致,怎么办? 


####  如果客户端与服务端的用户身份并不一致,怎么办?

* 对于linux系统来说文件系统的inode所记录的属性为UID和GID,当访问目录时通过UID(/etc/passwd)与GID(/etc/group)判断用户权限的;但是服务器端可能会出现没有这个UID和GID的情况,所以对应一下几种情况

### NFS Server/NFS Client 刚好有相同的账号和用户组
* 这种情况下,就以该一般用户身份访问服务器提供的文件系统
### NFS Server的UID刚好对应的请求目录的用户的UID
* 如果服务端的UID为6001,用户名为aa,服务端的用户的UID为6001,用户名bb,如有以bb访问共享目录时,相当于服务端使用aa用户来访问这个共享文件;
* 只是因为两者具有相同的UID而已,这个就有问题,没有人可以保证客户端用户与服务端用户的账号相同,会出现文件被被错误的用户乱改

### NFS Server没有相同的UID
* 如果服务器端没有对应的UID,这个一般用户会被压缩为匿名用户,一般NFS的匿名会把65534作为ID,这个是CentOS的习惯
`nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin`

### 如果客户端是root
* 在默认情况下root用户会被压缩为匿名用户就是nfsnobody


> 总之,客户端能做的事情是与UID与GID相关,当服务端与客户端的UID不一致时,可能造成文件系统使用上的混乱这个是NFS使用上的弊端;


### 其他 
* 实际上了解UID与GID之后,要在客户端以NFS使用服务端的NFS文件系统时,还要具备
1. NFS服务器已经开放可写入权限(rw)
2. 实际文件权限具有可写入(w)的权限

* 总结可写入权限的限制 :
1. 满足用户账号UID身份相关,即这个UID具有可以在这个目录下的w权限
2. NFS服务配置的客户端权限允许写入
3. 文件系统创建时具有w权限   
* 同时满足三点才可以在客户端写入服务的文件
