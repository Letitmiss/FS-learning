## [目录](https://github.com/Letitmiss/FS-learning/blob/master/README.md)

# NFS客户端的设定

## 手动挂载
* 手动挂载的步骤
1. 确认本地端已经启动了rpcbind的服务
2. 扫描NFS服务器分享的目录有哪些,而且查看本机是否有权限
3. 在本地创建要挂载的目录,就是挂载点
4. 利用mount将远程主机直接挂载到创建的挂载点目录

* 基本的组网规划 10.253.177.9 NFS Server 与 10.253.177.13 NFS client1 和10.253.177.15 NFS Client2  
```bash
# 登陆 10.253.177.13 
lfg1000708004:/ # /etc/init.d/rpcbind start
Starting rpcbind                     done
lfg1000708004:~ # showmount -e 10.253.177.9
Export list for 10.253.177.9:
/tmp         *
/home/linux  10.253.177.10/24
/home/test   10.253.177.13
/home/public (everyone)
lfg1000708004:/ # mkdir -p /home/nfs/public   # 创建目录
lfg1000708004:/ # mount -t nfs 10.253.177.9:/home/public /home/nfs/public/   # 挂载
lfg1000708004:/ # df -h   # 查看挂载信息
Filesystem                 Size  Used Avail Use% Mounted on
/dev/vda2                  132G   38G   88G  31% /
udev                       3.9G  128K  3.9G   1% /dev
tmpfs                       24G   12M   24G   1% /dev/shm
shm                         24G   12M   24G   1% /dev/shm
/dump                      132G   38G   88G  31% /home/core
10.253.177.9:/home/public  132G   28G   98G  22% /home/nfs/public
lfg1000708004:/ # umount /home/nfs/public/  # 卸载
```
* 测试 
```bash
1. 服务端加文件
lfg1000708009:/home/public # touch NFSServerroot.sh
lfg1000708009:/home/public # ll
total 0
-rw-r--r-- 1 root root 0 Nov 21 09:48 NFSServerroot.sh
2. 客户端查看
lfg1000708004:/home/nfs/public # ll
total 0
-rw-r--r-- 1 root root 0 Nov 21 09:48 NFSServerroot.sh
```
### 挂载的权限设置
* 客户端挂载文件系统,服务端给了rw,但是如果不小心有`rm -rf *` ,所以挂载时可以设置自我保护,就是`mount`的参数


## 共享权限测试
* 上面测试了共享目录查看,来看看共享目录的写 以 `/home/public (everyone)`共享文件夹为例;查看具体权限
```bash
lfg1000708009:/home/public # cat /var/lib/nfs/etab 
/home/public	10.253.177.10/24(rw,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,anonuid=65534,anongid=65534)
/home/public	*(ro,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,anonuid=65534,anongid=65534)
```
### 以root身份创建文件
```
lfg1000708004:/home/nfs/public # touch NFSClient1.sh
touch: cannot touch `NFSClient1.sh': Permission denied
```
* 为什么没有权限? 
1. 首先/home/public是有两种配置一种是IP的配置,一种是域名通配符配置,目前使用的客户端满足第一种IP的配置, 首先服务端配置了rw权限,配置root_squash,表示root用户会被压缩为anonuid=65534,anongid=65534.这个对应系统nobody用户; 查看服务器的nobody用户对/home/public是否有写权限,这里显示没有w,所以没有权限写入文件
```
lfg1000708009:/ # ll -d /home/public/
drwxr-xr-x 2 root root 4096 Nov 21 09:48 /home/public/
# 服务端设置nobody对/home/public有rwx权限
lfg1000708009:/ # setfacl -m u:nobody:rwx /home/public/
```
```
# 客户端以root身份再次创建文件
lfg1000708004:/home/nfs/public # touch NFSClient1.sh   # 创建文件ok
lfg1000708004:/home/nfs/public # ll
total 0
-rw-r--r-- 1 nobody nogroup 0 Nov 21 10:48 NFSClient1.sh  
-rw-r--r-- 1 root   root    0 Nov 21 09:48 NFSServerroot.sh
```
* 查看文件属组是属于nobody nogroup ,并不是本机的root,也不是本机的nobody,是服务端的nobody, 而且本机的/home/nfs/public/目录权限并不是本机设定的,而是服务端修改这个文件权限,挂载点的权限也会改变;

### 以一般用户而且在服务端有对应的UID
* 对应UID是同一个用户
* 对应UID不是同一个用户名
### 以一般用户在服务端没有对应的UID





